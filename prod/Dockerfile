FROM cgr.dev/chainguard/wolfi-base

ARG DB_HOST
ARG DB_DRIVER
ARG DB_USER
ARG DB_PASSWORD
ARG DB_NAME
ARG DB_PORT

ARG PORT

ARG JWT_SECRET

ARG ENVIRONMENT
ARG DEVELOPMENT

ARG APP_NAME
ARG APP_ID
ARG APP_GRACEFUL_SHUTDOWN_TIMEOUT

ARG SERVER_SWAGGER_HOST
ARG SERVER_ADDRESS
ARG SERVER_READ_TIMEOUT
ARG SERVER_WRITE_TIMEOUT
ARG SERVER_PORT

ENV DB_HOST ${DB_HOST}
ENV DB_DRIVER ${DB_DRIVER}
ENV DB_USER ${DB_USER}
ENV DB_PASSWORD ${DB_PASSWORD}
ENV DB_NAME ${DB_NAME}
ENV DB_PORT ${DB_PORT}

ENV JWT_SECRET ${JWT_SECRET}

ENV ENVIRONMENT=${ENVIRONMENT}
ENV DEVELOPMENT=${DEVELOPMENT}

ENV APP_NAME ${APP_NAME}
ENV APP_ID ${APP_ID}
ENV APP_GRACEFUL_SHUTDOWN_TIMEOUT ${APP_GRACEFUL_SHUTDOWN_TIMEOUT}

ENV SERVER_SWAGGER_HOST ${SERVER_SWAGGER_HOST}
ENV SERVER_ADDRESS ${SERVER_ADDRESS}
ENV SERVER_READ_TIMEOUT ${SERVER_READ_TIMEOUT}
ENV SERVER_WRITE_TIMEOUT ${SERVER_WRITE_TIMEOUT}
ENV SERVER_PORT ${SERVER_PORT}

RUN apk add ca-certificates && update-ca-certificates
RUN adduser -D -H -h "/nonexistent" -s "/sbin/nologin" -g "" -u "10001" "appuser"

USER appuser

WORKDIR /app
COPY ./bin ./

EXPOSE $SERVER_PORT

# Run
CMD [ "./farmacia_tech_hub" ] 